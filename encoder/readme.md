This is an encoder setup for stm32f103c8

PWM - TIM1
Encoder TIM2

Connect SW, CLK - to PA15, PB13
LED - PA8
